<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rifa 1 a 100</title>

<!-- SheetJS para exportar XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
  :root{
    --verde:#4caf50;
    --vermelho:#e53935;
    --bg:#f7f7f7;
    --card:#ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, Arial, sans-serif;
    background:var(--bg);
    color:#222;
    padding:20px;
    display:flex;
    justify-content:center;
  }

  .wrap{
    width:100%;
    max-width:820px;
  }

  h1{
    text-align:center;
    margin:6px 0 14px 0;
    font-size:20px;
  }

  .grid{
    display:grid;
    grid-template-columns:repeat(10,1fr);
    gap:10px;
    padding:6px;
  }

  @media(max-width:700px){
    .grid{grid-template-columns:repeat(6,1fr)}
  }
  @media(max-width:420px){
    .grid{grid-template-columns:repeat(5,1fr)}
  }

  .num{
    background:var(--verde);
    color:#fff;
    min-height:52px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:10px;
    font-weight:700;
    cursor:pointer;
    padding:8px;
    text-align:center;
    user-select:none;
  }
  .num.vendido{
    background:var(--vermelho);
  }

  .actions-row{
    display:flex;
    gap:10px;
    justify-content:center;
    margin-top:14px;
    flex-wrap:wrap;
  }
  .btn{
    padding:10px 14px;
    border-radius:8px;
    border:0;
    cursor:pointer;
    font-weight:600;
  }
  .btn-export{ background:#2e7d32; color:#fff; }

</style>
</head>
<body>
  <div class="wrap">
    <h1>Rifa 1 a 100</h1>

    <div id="grid" class="grid"></div>

    <div class="actions-row">
      <button class="btn btn-export" id="btnExport">Exportar XLSX</button>
    </div>
  </div>

  <!-- Modal cadastro -->
  <div id="modalCadastro" class="overlay" style="display:none">
    <div class="card" style="border-left:6px solid var(--verde);padding:16px">
      <h3 id="tituloCadastro" style="color:var(--verde)"></h3>
      <input id="inputNome" type="text" placeholder="Nome" style="width:100%;padding:10px;margin-top:8px">
      <input id="inputTel" type="text" placeholder="Telefone" style="width:100%;padding:10px;margin-top:8px">
      <div style="margin-top:12px;text-align:center">
        <button id="confirmBtn" class="btn" style="background:var(--verde);color:#fff">Confirmar</button>
        <button id="cancelBtn" class="btn" style="background:#ccc">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal mostrar comprador -->
  <div id="modalShow" class="overlay" style="display:none">
    <div class="card" style="border-left:6px solid var(--vermelho);padding:16px">
      <h3 style="color:var(--vermelho)">Número Vendido</h3>
      <div id="infoShow" style="margin-top:10px;font-size:15px"></div>
      <div style="margin-top:12px;text-align:center">
        <button id="closeShow" class="btn" style="background:#ccc">Fechar</button>
      </div>
    </div>
  </div>

<script>
const STORAGE_KEY = 'rifa_vendidos';
let vendidos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

const grid = document.getElementById('grid');
const modalCadastro = document.getElementById('modalCadastro');
const modalShow = document.getElementById('modalShow');
const inputNome = document.getElementById('inputNome');
const inputTel = document.getElementById('inputTel');
const tituloCadastro = document.getElementById('tituloCadastro');
const infoShow = document.getElementById('infoShow');
let numeroAtivo = null;

// Criar grid
function montar(){
  grid.innerHTML = '';
  for(let i=1;i<=100;i++){
    const d = document.createElement('div');
    d.className = 'num';
    d.innerText = i;
    if(vendidos[i]) d.classList.add('vendido');

    d.onclick = ()=> {
      if(vendidos[i]) mostrar(i);
      else cadastrar(i);
    };

    grid.appendChild(d);
  }
}

function cadastrar(n){
  numeroAtivo = n;
  tituloCadastro.innerText = "Comprar número " + n;
  inputNome.value = "";
  inputTel.value = "";
  modalCadastro.style.display = "flex";
}

document.getElementById('confirmBtn').onclick = ()=>{
  vendidos[numeroAtivo] = {
    nome: inputNome.value.trim(),
    telefone: inputTel.value.trim()
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(vendidos));
  modalCadastro.style.display = "none";
  montar();
};

document.getElementById('cancelBtn').onclick = ()=> modalCadastro.style.display="none";

function mostrar(n){
  let d = vendidos[n];
  infoShow.innerHTML = `
    <b>Número:</b> ${n}<br>
    <b>Nome:</b> ${d.nome}<br>
    <b>Telefone:</b> ${d.telefone}
  `;
  modalShow.style.display = "flex";
}

document.getElementById('closeShow').onclick = ()=> modalShow.style.display="none";

/* ========= EXPORTAR XLSX BONITINHO ========= */
document.getElementById("btnExport").onclick = function() {
  const dados = [["Número","Nome","Telefone"]];

  Object.keys(vendidos)
    .sort((a,b)=>a-b)
    .forEach(num=>{
      dados.push([num, vendidos[num].nome, vendidos[num].telefone]);
    });

  const ws = XLSX.utils.aoa_to_sheet(dados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Rifa");

  XLSX.writeFile(wb, "rifa.xlsx");
};

montar();
</script>
</body>
</html>